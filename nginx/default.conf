# upstream backend_app {
#     # Ini TIDAK diperlukan lagi di Nginx frontend.
#     # Frontend akan memanggil API melalui Ingress Controller, bukan Nginx ini.
#     # server backend-service:8080;
# }

# upstream verificator_app {
#     # Ini TIDAK diperlukan lagi di Nginx frontend.
#     # Frontend akan memanggil API melalui Ingress Controller, bukan Nginx ini.
#     # server verificator-service:8081;
# }

# server {
#     listen 80;
#     server_name localhost; # Atau nama domain Anda jika ada

#     # Ini adalah bagian terpenting: melayani file statis frontend
#     location / {
#         root /usr/share/nginx/html; # Pastikan jalur ini benar ke folder build aplikasi frontend Anda
#         index index.html index.htm;
#         try_files $uri $uri/ /index.html; # Penting untuk aplikasi SPA (Single Page Application)
#     }

#     # HAPUS SEMUA BLOCK location /api/auth/ dan location /api/dukcapil/ !
#     # Karena sudah dihandle oleh Kubernetes Ingress Controller.

#     error_page 500 502 503 504 /50x.html;
#     location = /50x.html {
#         root /usr/share/nginx/html;
#     }
# }
###########################################

server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;
  index index.html;

  location / {
    try_files $uri $uri/ /index.html;
  }

  # Jika ada API backend
  # location /api/ {
  #   proxy_pass http://backend:8080;
  # }
}

##########################################3

# upstream backend_app {
#     # DIUBAH: Gunakan nama Service Kubernetes untuk backend
#     server backend-service:8080; # <--- nama service Kubernetes
# }

# upstream verificator_app {
#     # DIUBAH: Gunakan nama Service Kubernetes untuk verifikator
#     server verifikator-service:8081; # <--- nama service Kubernetes
# }

# server {
#     listen 80;
#     server_name localhost;

#     location / {
#         root /usr/share/nginx/html;
#         index index.html index.htm;
#         try_files $uri $uri/ /index.html;
#     }

#     location /api/auth/ {
#         proxy_pass http://backend_app; # <--- PERUBAHAN PENTING: Hapus trailing slash di sini!
#         # SEBELUMNYA : http://backend_app/;
#         # Jadi, jika frontend meminta http://<frontend-url>/api/auth/register, Nginx akan meneruskannya ke backend-service:8000 sebagai http://backend-service:8000/auth/register.
#         # padahal endpoint FastAPI-nya adalah /api/auth/register
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     location /api/dukcapil/ {
#         proxy_pass http://verificator_app; # <--- PERUBAHAN PENTING: Hapus trailing slash di sini!

#         # Jadi, jika frontend meminta http://<frontend-url>/api/dukcapil/verify-nik, Nginx akan meneruskannya ke backend-service:8000 sebagai http://backend-service:8000/verify-nik.
#         # padahal endpoint FastAPI-nya adalah /api/auth/register
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

#     error_page 500 502 503 504 /50x.html;
#     location = /50x.html {
#         root /usr/share/nginx/html;
#     }
# }